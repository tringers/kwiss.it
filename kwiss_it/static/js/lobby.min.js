class t{qtid=[];qtname=[];qtdescription=[];addQuestionType(t,e,n){this.qtid.push(t),this.qtname.push(e),this.qtdescription.push(n)}getQuestionType(e){for(let t=0;t<this.qtid.length;t++)if(this.qtid[t]===e)return{name:this.qtname[t],description:this.qtdescription[t]}}}const d=document.getElementById("lobby-data").getAttribute("data-lobby-key"),i=document.getElementById("crypto"),a=document.getElementById("question-data"),s=document.getElementById("answer-data"),r=new TextEncoder,l=new TextDecoder,e=document.getElementById("btnReady"),n=document.getElementById("playeramount");let u,o=0,c={meta:{maxQuestions:0,timeStarted:0,timePerQuestion:20,qTypes:new t},interval:null};function b(t){fetch("/lobby/ready/"+d+"/"+t.toString())}if(e.addEventListener("click",()=>{switch(parseInt(e.getAttribute("data-value"))){case 0:e.value="Nicht bereit",e.setAttribute("data-value","1"),b(!0);break;case 1:e.value="Bereit",e.setAttribute("data-value","0"),b(!1)}}),0===parseInt(i.getAttribute("data-iv"))){let t=crypto.getRandomValues(new Uint8Array(16)),e=t.join(",");i.setAttribute("data-iv",e)}function m(){let t=i.getAttribute("data-iv");var e=t.split(","),n=new ArrayBuffer(16);let a=new Uint8Array(n);for(let t=0;t<e.length;t++)a[t]=parseInt(e[t]);return n}async function h(t,e){var n=r.encode(t),t=r.encode(e),e=await crypto.subtle.digest("SHA-256",t),t={name:"AES-GCM",iv:m()},e=await crypto.subtle.importKey("raw",e,t,!1,["encrypt"]);return p(await crypto.subtle.encrypt(t,e,n))}async function y(t,e){var n=r.encode(e),e=await crypto.subtle.digest("SHA-256",n),n={name:"AES-GCM",iv:m()},e=await crypto.subtle.importKey("raw",e,n,!1,["decrypt"]),t=f(t),t=await crypto.subtle.decrypt(n,e,t);return l.decode(t)}function p(t){let e="";var n=new Uint8Array(t),a=n.byteLength;for(let t=0;t<a;t++)e+=String.fromCharCode(n[t]);return window.btoa(e)}function f(t){let e=window.atob(t);var n=e.length;let a=new Uint8Array(n);for(let t=0;t<n;t++)a[t]=e.charCodeAt(t);return a.buffer}let g=setInterval(()=>{fetch("/lobby/heartbeat/"+d).then(t=>{o=0,t.json().then(t=>{if(200===parseInt(t.status))u=t.name;else{let t=document.getElementById("lobby-error"),e=document.getElementById("lobby-error-content");e.innerHTML="Verbindung unterbrochen. Zu lange keine Verbindung zur Lobby beibehalten. Leite zurÃ¼ck zur Lobbyliste.",t.hidden=!1,t.classList.remove("invisible"),setTimeout(()=>{window.location.href=base_url+"/lobbylist"},5e3)}})}).catch(()=>o++),fetch(api_url+"/lobbyuser/?lkey="+d).then(t=>t.json().then(i=>{const r=document.getElementById("table-body");let d=!1;n.innerHTML=i.length;let s=!0;for(let a=0;a<i.length;a++){var l=i[a],o=l.first_name,l=l.LPready;l||(s=!1);let t=document.createElement("tr"),e=document.createElement("td"),n=document.createElement("td");e.innerHTML=o,n.innerHTML=l?"Bereit":"Nicht bereit",o===u?t.classList.add("table-info"):l?t.classList.add("table-success"):t.classList.add("table-danger"),n.classList.add("text-center"),t.appendChild(e),t.appendChild(n),d||(r.innerHTML="",d=!0),r.appendChild(t)}s&&(e.disabled=!0,prepGame())}))},250);function w(){clearInterval(g)}function A(){fetch(api_url+"/lobbydata/?lkey="+d).then(t=>t.json().then(t=>{t.length<1||(t=t[0],c.meta.timePerQuestion=parseInt(t.Ltimeamount))}))}function q(){fetch(api_url+"/questiontype/").then(t=>t.json().then(e=>{for(let t=0;t<e.length;t++)c.meta.qTypes.addQuestionType(parseInt(e[t].QTid),e[t].QTname,e[t].QTdescription)})),fetch(api_url+"/lobbyquestions/?lkey="+d).then(t=>t.json().then(t=>{c.meta.maxQuestions=t.length;for(let r=0;r<t.length;r++){let i=t[r].Qid;fetch(api_url+"/question/?qid="+i).then(t=>t.json().then(n=>{h(n[0].Qtext,d).then(t=>{let e=document.createElement("meta");e.id="question-"+r,e.classList.add("question-data"),e.setAttribute("data-qid",i),e.setAttribute("data-cid",n[0].Cid),e.setAttribute("data-cname",n[0].Cname),e.setAttribute("data-qtext",t),e.setAttribute("data-qtype",n[0].QTid),a.appendChild(e),fetch(api_url+"/answer/?qid="+i).then(t=>t.json().then(a=>{for(let n=0;n<a.length;n++)h(a[n].Atext,d).then(t=>{let e=document.createElement("meta");e.id="answer-"+r+"-"+n,e.classList.add("answer-data"),e.classList.add("answer-question-"+r),e.setAttribute("data-qid",i),e.setAttribute("data-anum",a[n].Anum),e.setAttribute("data-atext",t),s.appendChild(e)})}))})}))}}))}setTimeout(A,1e3),setTimeout(q,2e3);