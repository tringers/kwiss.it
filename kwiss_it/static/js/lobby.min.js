const d=document.getElementById("lobby-data").getAttribute("data-lobby-key"),r=document.getElementById("crypto"),a=document.getElementById("question-data"),l=document.getElementById("answer-data"),i=new TextEncoder,o=new TextDecoder,t=document.getElementById("btnReady"),e=document.getElementById("playeramount");let s,n=0;function u(t){fetch("/lobby/ready/"+d+"/"+t.toString())}if(t.addEventListener("click",()=>{switch(parseInt(t.getAttribute("data-value"))){case 0:t.value="Nicht bereit",t.setAttribute("data-value","1"),u(!0);break;case 1:t.value="Bereit",t.setAttribute("data-value","0"),u(!1)}}),0===parseInt(r.getAttribute("data-iv"))){let t=crypto.getRandomValues(new Uint8Array(16)),e=t.join(",");r.setAttribute("data-iv",e)}function c(){let t=r.getAttribute("data-iv");var e=t.split(","),n=new ArrayBuffer(16);let a=new Uint8Array(n);for(let t=0;t<e.length;t++)a[t]=parseInt(e[t]);return n}async function b(t,e){var n=i.encode(t),t=i.encode(e),e=await crypto.subtle.digest("SHA-256",t),t={name:"AES-GCM",iv:c()},e=await crypto.subtle.importKey("raw",e,t,!1,["encrypt"]);return m(await crypto.subtle.encrypt(t,e,n))}async function y(t,e){var n=i.encode(e),e=await crypto.subtle.digest("SHA-256",n),n={name:"AES-GCM",iv:c()},e=await crypto.subtle.importKey("raw",e,n,!1,["decrypt"]),t=h(t),t=await crypto.subtle.decrypt(n,e,t);return o.decode(t)}function m(t){let e="";var n=new Uint8Array(t),a=n.byteLength;for(let t=0;t<a;t++)e+=String.fromCharCode(n[t]);return window.btoa(e)}function h(t){let e=window.atob(t);var n=e.length;let a=new Uint8Array(n);for(let t=0;t<n;t++)a[t]=e.charCodeAt(t);return a.buffer}let p=setInterval(()=>{fetch("/lobby/heartbeat/"+d).then(t=>{n=0,t.json().then(t=>{if(200===parseInt(t.status))s=t.name;else{let t=document.getElementById("lobby-error"),e=document.getElementById("lobby-error-content");e.innerHTML="Verbindung unterbrochen. Zu lange keine Verbindung zur Lobby beibehalten. Leite zurÃ¼ck zur Lobbyliste.",t.hidden=!1,t.classList.remove("invisible"),setTimeout(()=>{window.location.href=base_url+"/lobbylist"},5e3)}})}).catch(()=>n++),fetch(api_url+"/lobbyuser/?lkey="+d).then(t=>t.json().then(r=>{const i=document.getElementById("table-body");let d=!1;e.innerHTML=r.length;for(let a=0;a<r.length;a++){var l=r[a],o=l.first_name,l=l.LPready;let t=document.createElement("tr"),e=document.createElement("td"),n=document.createElement("td");e.innerHTML=o,n.innerHTML=l?"Bereit":"Nicht bereit",o===s?t.classList.add("table-info"):l?t.classList.add("table-success"):t.classList.add("table-danger"),n.classList.add("text-center"),t.appendChild(e),t.appendChild(n),d||(i.innerHTML="",d=!0),i.appendChild(t)}}))},500);function f(){fetch(api_url+"/lobbyquestions/?lkey="+d).then(t=>t.json().then(t=>{for(let i=0;i<t.length;i++){let r=t[i].Qid;fetch(api_url+"/question/?qid="+r).then(t=>t.json().then(n=>{b(n[0].Qtext,d).then(t=>{let e=document.createElement("meta");e.id="question-"+i,e.classList.add("question-data"),e.setAttribute("data-qid",r),e.setAttribute("data-qtext",t),e.setAttribute("data-qtype",n[0].QTid),a.appendChild(e),fetch(api_url+"/answer/?qid="+r).then(t=>t.json().then(a=>{for(let n=0;n<a.length;n++)b(a[n].Atext,d).then(t=>{let e=document.createElement("meta");e.id="answer-"+i+"-"+n,e.classList.add("answer-data"),e.setAttribute("for","question-"+i),e.setAttribute("data-qid",r),e.setAttribute("data-anum",a[n].Anum),e.setAttribute("data-atext",t),l.appendChild(e)})}))})}))}}))}setTimeout(f,2e3);